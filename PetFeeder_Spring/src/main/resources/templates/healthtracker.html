<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker Predictions</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"/>
</head>
<body>
<header th:insert="~{navbar.html}"></header>

<main class="container mt-5">
    <h1 class="text-center mb-4">Health Tracker</h1>

    <div class="text-center">
        <h2>Descriptive Data Analysis Visualisation</h2>
        <div id="graph-container" class="mt-4">
            <h3>Growth Trend</h3>
            <img id="growth-trend" class="img-fluid mt-3" alt="Growth Trend Graph" src="/plots/growth_trend.png">

            <h3>Food Intake Trend</h3>
            <img id="food-intake-trend" class="img-fluid mt-3" alt="Food Intake Trend Graph" src="/plots/food_intake_trend.png">
        </div>

        <div id="health-assessment" class="mt-5">
            <h2>Health Assessment</h2>

            <!-- Verdict Table -->
            <h3>Verdict</h3>
            <table class="table table-bordered table-striped mt-3">
                <thead>
                <tr>
                    <th>Age (Weeks)</th>
                    <th>Health Status</th>
                </tr>
                </thead>
                <tbody id="verdict-table-body">
                <!-- Verdict rows will be added dynamically -->
                </tbody>
            </table>
        </div>
    </div>
</main>

<footer th:insert="~{footer.html}" class="mt-5"></footer>

<script>
    // Fetch real data dynamically from the Spring Boot endpoint
    fetch('/api/visualize', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to fetch data from the Spring Boot API.");
            }
            return response.json();
        })
        .then(data => {
            console.log('Response from Flask API:', data);

            // Display Growth Trend Plot
            if (data.plots && data.plots.length > 0) {
                document.getElementById('growth-trend').src = '/plots/' + data.plots[0];
                document.getElementById('food-intake-trend').src = '/plots/' + data.plots[1];
            } else {
                console.error("Plot data is missing in the response.");
            }

            // Populate Verdict Table
            const verdictTableBody = document.getElementById('verdict-table')
            if (data.verdict_data && data.verdict_data.length > 0) {
                // Clear the table body first
                verdictTableBody.innerHTML = '';

                // Add rows dynamically
                data.verdict_data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.age_weeks}</td>
                        <td>${row.health_status}</td>`;
                    verdictTableBody.appendChild(tr);
                });
            } else {
                verdictTableBody.innerHTML = `
                    <tr>
                        <td colspan="2" class="text-center text-danger">No verdict data available.</td>
                    </tr>`;
                console.error("Verdict data is missing in the response.");
            }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            const graphContainer = document.getElementById('graph-container');
            graphContainer.innerHTML = `
                <div class="alert alert-danger mt-3">
                    Failed to load data from the server. Please try again later.
                </div>`;
        });
</script>


</body>
</html>
