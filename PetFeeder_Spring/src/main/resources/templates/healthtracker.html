<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker Predictions</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"/>
</head>
<body>
<header th:insert="~{navbar.html}"></header>

<main class="container mt-5">
    <h1 class="text-center mb-4">Health Tracker Predictions</h1>

    <div class="text-center">
        <h2>Visualization of Predictions</h2>
        <div id="graph-container" class="mt-4">
            <!-- Graphs -->
            <h3>Growth Trend</h3>
            <img id="growth-trend" class="img-fluid mt-3" alt="Growth Trend Graph">
            <h3>Food Intake Trend</h3>
            <img id="food-intake-trend" class="img-fluid mt-3" alt="Food Intake Trend Graph">
        </div>

        <div id="health-assessment" class="mt-4 text-start">
            <h3>Health Assessment</h3>
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Age (Weeks)</th>
                    <th>Food Intake</th>
                    <th>Pet Weight</th>
                    <th>Health Status</th>
                </tr>
                </thead>
                <tbody id="health-status-table">
                <!-- Health data rows will be dynamically added here -->
                </tbody>
            </table>
        </div>

        <script>
            async function loadVisualizations() {
                try {
                    // Fetch visualization data from the Flask backend
                    const response = await fetch('/api/visualize', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({})
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch visualizations');
                    }

                    const data = await response.json();

                    // Dynamically load graphs
                    const growthTrend = document.getElementById('growth-trend');
                    const foodIntakeTrend = document.getElementById('food-intake-trend');

                    growthTrend.src = `/plots/${data.plots[0]}`;
                    foodIntakeTrend.src = `/plots/${data.plots[1]}`;

                    // Populate the Health Status Table
                    const tableBody = document.getElementById('health-status-table');
                    tableBody.innerHTML = '';
                    data.health_data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                <td>${item.age_weeks}</td>
                <td>${item.food_intake.toFixed(2)}</td>
                <td>${item.pet_weight.toFixed(2)}</td>
                <td style="color: ${item.health_status === "Healthy" ? "green" : "red"}">
                    ${item.health_status}
                </td>
            `;
                        tableBody.appendChild(row);
                    });
                } catch (error) {
                    console.error('Error loading visualizations:', error);
                }
            }

            window.onload = loadVisualizations;
        </script>

    </div>
</main>

<footer th:insert="~{footer.html}" class="mt-5"></footer>

</body>
</html>
