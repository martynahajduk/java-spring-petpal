<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker Predictions</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"/>
</head>
<body>
<header th:insert="~{navbar.html}"></header>

<main class="container mt-5">
    <h1 class="text-center mb-4">Health Tracker Predictions</h1>

    <!-- Buttons to Fetch Different Graphs -->
    <div class="text-center mb-4">
        <button class="btn btn-primary m-2" onclick="fetchGrowthTrend()">Growth Trend</button>
        <button class="btn btn-success m-2" onclick="fetchFoodIntakeTrend()">Food Intake Trend</button>
        <button class="btn btn-info m-2" onclick="fetchScatterPlot()">Scatter Plot</button>
        <button class="btn btn-warning m-2" onclick="fetchBarChart()">Bar Chart</button>
        <button class="btn btn-danger m-2" onclick="fetchHeatmap()">Heatmap</button>
    </div>

    <!-- Graph Container -->
    <div id="graph-container" class="text-center mt-4">
        <h3 id="graph-title">Click a Button to Display a Graph</h3>
        <img id="graph-image" class="img-fluid mt-3" alt="Graph will display here" style="max-width: 80%;"/>
    </div>

    <!-- Health Assessment Section -->
    <div id="health-assessment" class="mt-5">
        <h2>Health Assessment</h2>
        <h3>Verdict</h3>
        <table class="table table-bordered table-striped mt-3">
            <thead>
            <tr>
                <th>Age (Weeks)</th>
                <th>Health Status</th>
            </tr>
            </thead>
            <tbody id="verdict-table-body">
            <tr>
                <td colspan="2" class="text-center text-danger">No verdict data available.</td>
            </tr>
            </tbody>
        </table>
    </div>
</main>

<footer th:insert="~{footer.html}" class="mt-5"></footer>

<!-- JavaScript -->
<script>
    // Fetch Growth Trend Graph
    function fetchGrowthTrend() {
        fetchGraph('/api/visualize', 'Growth Trend', 'growth_trend_base64');
    }

    // Fetch Food Intake Trend Graph
    function fetchFoodIntakeTrend() {
        fetchGraph('/api/visualize', 'Food Intake Trend', 'food_intake_trend_base64');
    }

    // Fetch Scatter Plot
    function fetchScatterPlot() {
        fetchGraph('/api/descriptive', 'Scatter Plot', 'scatter_plot_base64');
    }

    // Fetch Bar Chart
    function fetchBarChart() {
        fetchGraph('/api/descriptive', 'Bar Chart', 'bar_chart_base64');
    }

    // Fetch Heatmap
    function fetchHeatmap() {
        fetchGraph('/api/descriptive', 'Heatmap', 'heatmap_base64');
    }

    // Generic Function to Fetch and Display Graphs
    function fetchGraph(endpoint, graphTitle, graphKey) {
        document.getElementById('graph-title').innerText = `Loading ${graphTitle}...`;
        fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({})
        })
            .then(response => {
                if (!response.ok) throw new Error("Failed to fetch data.");
                return response.json();
            })
            .then(data => {
                const graphImage = document.getElementById('graph-image');
                if (data[graphKey]) {
                    graphImage.src = `data:image/png;base64,${data[graphKey]}`;
                    document.getElementById('graph-title').innerText = graphTitle;
                } else {
                    graphImage.src = '';
                    graphImage.alt = `${graphTitle} not available.`;
                    document.getElementById('graph-title').innerText = `${graphTitle} not available`;
                }
            })
            .catch(error => {
                console.error(`Error fetching ${graphTitle}:`, error);
                document.getElementById('graph-title').innerText = `Error loading ${graphTitle}.`;
                document.getElementById('graph-image').src = '';
            });
    }
</script>
</body>
</html>
